<head>
  <title>simple</title>
  <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script>
  <link rel="stylesheet" href="/css/main.css">
  <script type="text/javascript" src="/js/mapbox.js"></script>
  
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  
</head>

<body>
    
    <img src="http://www.i2symbol.com/css/chat/facebook/memes/hires/cat_overload_cat_meme.png" id="cat">
    
  <div id='map'></div>
<input id='search' class='search-ui' placeholder='Enter state code' style="display: none;" />

<div class="form1_out">
    <a href="#" id="geolocate" class="ui-button" style="
    position: absolute;
    left: 30px;
    top: 38px;
    box-shadow: 1px 1px 2px black;
    border: 0;
    border-radius: 60px;
    background: #FF8686;
    display: table;
    text-decoration: none;
    width: 40px;
    padding: 11px 0px 6px 1px;
    "><img src="http://www.libraires-rhonealpes.fr/templates/lira-v1/img/customMarker.png" height="20" data-pin-nopin="true"></a>
	<form action="" method="POST" class="form1">
	    <div>
		<div style="background: #4CAF50;
    border: 0;
    padding: 10px 15px;    color: white;float: left;">Откуда:</div>
		<input type="text" name="from1" class="from1" id="from_field" placeholder="Ваш адрес"/>
		<label><input type="checkbox" name="komnata" /><span>Комната</span></label>
		<label><input type="checkbox" name="komnata1" /><span>1</span></label>
		<label><input type="checkbox" name="komnata2" /><span>2</span></label>
		<label><input type="checkbox" name="komnata3" /><span>3</span></label>
		<label><input type="checkbox" name="komnata4" /><span>4+</span></label>
		<input type="text" name="to1" placeholder="Ваша текущая арендная плата" />
		<div style="clear: both;"></div>
		</div>
	    <div style="margin: 10px 0 0;">
		<div style="background: #8686FF;
    border: 0;
    padding: 10px 22px;    color: white;float: left;">Куда:</div>
		<input type="text" name="from1" class="from1" id="to_field" placeholder="Желаемый адрес" />
		<label><input type="checkbox" name="komnata" /><span>Комната</span></label>
		<label><input type="checkbox" name="komnata1" /><span>1</span></label>
		<label><input type="checkbox" name="komnata2" /><span>2</span></label>
		<label><input type="checkbox" name="komnata3" /><span>3</span></label>
		<label><input type="checkbox" name="komnata4" /><span>4+</span></label>
		<input type="text" name="to1" placeholder="Ваша желаемая арендная плата" />
		</div>
		<input type="submit" value="Переехать" style="float: right;
    margin: 10px 0 0;
    padding: 10px;
    color: white;
    cursor: pointer;
    box-shadow: 1px 1px 2px black;
    border-radius: 60px;
    border: 0;
    background: #8686FF;" />
	</form>
	
	
</div>


<div id="images" style="position: absolute">
  </div>


<style>
#cat {
        position: absolute;
    z-index: 12;
    bottom: -286px;
}
</style>

<script>

    L.mapbox.accessToken = 'pk.eyJ1IjoicnVzdGVtcSIsImEiOiI2NDc5MzI2ZTZmMjc3Y2Y4YzEyMWI1OTU1N2VkOWVmMyJ9.Dxt1NnthR_sYu8aOsR3NSg';
    var map = L.mapbox.map('map', 'mapbox.streets')
        .setView([55.74, 37.63], 11);
        
    var myLayer = L.mapbox.featureLayer().addTo(map);
    var featureLayer = L.mapbox.featureLayer().addTo(map);
    var featureLayer2 = L.mapbox.featureLayer().addTo(map);
    var user_src;
    var user_dst;
    
    if (!navigator.geolocation) {
        geolocate.innerHTML = 'Geolocation is not available';
    } else {
        geolocate.onclick = function (e) {
            e.preventDefault();
            e.stopPropagation();
            map.locate();
        };
    }
    
    //--------
    
    var csvLayer = omnivore.csv('airports.csv', null, L.mapbox.featureLayer().on('ready', function(e) {
        // The clusterGroup gets each marker in the group added to it
        // once loaded, and then is added to the map
        var clusterGroup = new L.MarkerClusterGroup();
        e.target.eachLayer(function(layer) {
            clusterGroup.addLayer(layer);
        });
        map.addLayer(clusterGroup);
    }));
    
    
    var csvLayer1 = omnivore.csv('workout.csv', null, L.mapbox.featureLayer().on('ready', function(e) {
        
        
        // The clusterGroup gets each marker in the group added to it
        // once loaded, and then is added to the map
        var clusterGroup = new L.MarkerClusterGroup();
        e.target.eachLayer(function(layer) {
            clusterGroup.addLayer(layer);
        });
        map.addLayer(clusterGroup);
    }));
    
    //-----------
    
    var marker_source = L.marker(new L.LatLng(55.74, 37.575), {
        icon: L.mapbox.marker.icon({
            'marker-color': '4CAF50',
                "marker-size" : "large"
        }),
        draggable: true,
        title: 'Hi'
        });
        marker_source.bindPopup('This marker is draggable! Move it around.');
        marker_source.addTo(map);
        
    var marker_destination = L.marker(new L.LatLng(55.74, 37.66), {
            icon: L.mapbox.marker.icon({
                'marker-color': '8888ff',
                "marker-size" : "large"
            }),
            draggable: true
        });
        marker_destination.bindPopup('This marker is draggable! Move it around.');
        marker_destination.addTo(map);
    
    map.on('locationfound', function(e) {
        //map.fitBounds(e.bounds);
        
        user_src = e.latlng;
    
        marker_source.setLatLng(user_src);
    
        // And hide the geolocation button
        //geolocate.parentNode.removeChild(geolocate);
    });
    
    function locFound(e){
        
    }
    
    map.on('mouseup', function(e) {
        user_src = marker_source.getLatLng();
        user_dst = marker_destination.getLatLng();
        javascript: console.log(user_src, ' ', user_dst);
        getGeo(user_src.lat, user_src.lng, "from_field");
        getGeo(user_dst.lat, user_dst.lng, "to_field");
    })
    
    
    function search() {
        // get the value of the search input field
        var searchString = $('#search').val().toLowerCase();
    
        csvLayer.setFilter(showState);
    
        // here we're simply comparing the 'state' property of each marker
        // to the search string, seeing whether the former contains the latter.
        function showState(feature) {
            return feature.properties.state
                .toLowerCase()
                .indexOf(searchString) !== -1;
        }
    }
    
    $("label span").click(function () {
        $(this).toggleClass("active");
    });
</script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/angular.min.js"></script>
</body>

