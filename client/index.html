<head>

    <title>5 Min 2 Home - find new place in city</title>
 
    <link rel="stylesheet" href="/css/main.css">

    <script type="text/javascript" src="/js/mapbox.js"></script>
    <script type="text/javascript" src="/js/pg.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>

</head>

<body>

<div id='map'></div>
    
<input id='search' class='search-ui' placeholder='Enter state code' style="display: none;" />

<div class="form1_out">
    <a id="geolocate" class="ui-button" style="
    position: absolute;
    left: 30px;
    top: 38px;
    box-shadow: 1px 1px 2px black;
    border: 0;
    border-radius: 60px;
    background: #FF8686;
    display: table;
    text-decoration: none;
    width: 40px;
    padding: 11px 0px 6px 1px;
    "><img src="http://www.libraires-rhonealpes.fr/templates/lira-v1/img/customMarker.png" height="20" data-pin-nopin="true"></a>
	<form action="" method="POST" class="form1">
	    <div>
		<div style="
    background: #4CAF50;
    border: 0;
    padding: 10px 15px;    
    color: white;float: 
    left;">Откуда:</div>
		<input type="text" name="from1" class="from1" id="from_field" placeholder="Ваш адрес"/>
		<label><input type="checkbox" name="komnata" /><span>Комната</span></label>
		<label><input type="checkbox" name="komnata1" /><span>1</span></label>
		<label><input type="checkbox" name="komnata2" /><span>2</span></label>
		<label><input type="checkbox" name="komnata3" /><span>3</span></label>
		<label><input type="checkbox" name="komnata4" /><span>4+</span></label>
		<input type="text" name="to1" placeholder="Ваша текущая арендная плата" />
		<div style="clear: both;"></div>
		</div>
	    <div style="margin: 10px 0 0;">
		<div style="
    background: #8686FF;
    border: 0;
    padding: 10px 22px;    
    color: white;
    float: left;">Куда:</div>
		<input type="text" name="from1" class="from1" id="to_field" placeholder="Желаемый адрес" />
		<label><input type="checkbox" name="komnata" /><span>Комната</span></label>
		<label><input type="checkbox" name="komnata1" /><span>1</span></label>
		<label><input type="checkbox" name="komnata2" /><span>2</span></label>
		<label><input type="checkbox" name="komnata3" /><span>3</span></label>
		<label><input type="checkbox" name="komnata4" /><span>4+</span></label>
		<input type="text" name="to1" placeholder="Ваша желаемая арендная плата" />
		</div>
		<input type="submit" id="big_button" value="Переехать" style="float: right;
    margin: 10px 0 0;
    padding: 10px;
    color: white;
    cursor: pointer;
    box-shadow: 1px 1px 2px black;
    border-radius: 60px;
    border: 0;
    background: #8686FF;" />
	</form>
	
	
</div>

<div style="
    position: absolute;
    left: 5px;
    top: 100px;
    display: table;
    background: lightseagreen;
    width: 40px;
    padding: 11px 0px 6px 1px;
    " id="btn_a">
    <p>Text</p>
</div>

<script>

    var map,
        marker_dst,
        marker_src,
        lat_src,
        lat_dst,
        lng_src,
        lng_dst;
        
    DG.then(function() {

        var icon_src = DG.icon ({ iconUrl: '/img/home-from.png' }),
            icon_dst = DG.icon ({ iconUrl: '/img/home-to.png' });

        map = DG.map('map', {
            center: [55.75194599890442, 37.62044906616212],
            zoom: 13
        });

        marker_dst = DG.marker([55.74, 37.57], { draggable: 'true', icon: icon_dst }).addTo(map);
        marker_src = DG.marker([55.74, 37.66], { draggable: 'true', icon: icon_src }).addTo(map);

        map.on('click', function(e) {
            console.log('Вы кликнули на карту, координаты :' + e.latlng.lat + ', ' + e.latlng.lng);
        });

        marker_src.on('dragend', function (e) {
            lat_src = e.target._latlng.lat.toFixed(5);
            lng_src = e.target._latlng.lng.toFixed(5);
            getGeo(lat_src, lng_dst, "from_field");
        });

        marker_dst.on('dragend', function (e) {
            lat_dst = e.target._latlng.lat.toFixed(5);
            lng_dst = e.target._latlng.lng.toFixed(5);
            getGeo(lat_dst, lng_dst, "to_field");
        });

        document.getElementById("geolocate").onclick = function () { 
            map.locate({setView: true, watch: true})
                .on('locationfound', function(e) {
                    //DG.marker([e.latitude, e.longitude]).addTo(map);  // Set a marker on the curren user position
                    lng_src = e.longitude;
                    lat_src = e.latitude;
                    marker_src.setLatlng([lat_src,lng_src]);
                })
                .on('locationerror', function(e) {
                    console.log(e);
                    alert("Location access denied.");
                });
        };
        document.getElementById("btn_a").onclick = function () {
            var generator = new IDGenerator();
            //console.log("ID: " + generator.generate());
            //api_select("btn_a");
            //api_insert(lng_src, lat_src, lng_dst, lat_dst);
            //api_search_in_radius(lng_src, lat_src, 0.01);
            
            var all_markers = []
            maps_view(DG, map, function(q) {
                for (var i = 0; i < q.length; i++) {
                    DG.marker([q[i][1], q[i][0]]).addTo(map);
                }
            });
            
        };
        
    });    
    
</script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/angular.min.js"></script>

</body>

